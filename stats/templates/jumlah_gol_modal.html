{% load static %}

<div id="jumlahGolModal" class="hidden fixed inset-0 z-50 w-full flex items-center justify-center bg-black bg-opacity-70 transition-opacity duration-150">
  <div id="jumlahGolModalContent" class="bg-[#1d1f22] text-white rounded-2xl shadow-2xl w-5/6 sm:w-3/5 md:w-1/2 lg:w-2/5 xl:w-1/3 max-h-screen overflow-y-auto transform scale-95 opacity-0 transition-all duration-200 border border-gray-700">
    <div class="flex items-center justify-between p-5 border-b border-gray-700">
      <div>
        <h3 class="text-xl font-semibold text-white" id="modalTitle">Tambah Data Gol Baru</h3>
        <p class="text-sm text-gray-400 mt-1">Masukkan data jumlah gol (hanya angka)</p>
      </div>
      <button type="button" class="text-gray-400 hover:text-gray-200 p-1.5 rounded-lg" onclick="hideJumlahGolModal()">
        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>

    <div class="px-6 py-5 space-y-6">
      <form id="jumlahGolForm">
        {% csrf_token %}
        <div>
          <label for="jumlahGol" class="block text-sm font-medium text-gray-300">Jumlah Gol</label>
          <input type="number" id="jumlahGol" name="jumlahGol" min="0" class="mt-1 block w-full border border-gray-700 rounded-md px-3 py-2 bg-gray-800 text-gray-100 focus:ring-2 focus:ring-blue-500 focus:outline-none" placeholder="Masukkan jumlah gol (Angka Positif)" required>
        </div>
      </form>
    </div>

    <div class="flex flex-col sm:flex-row gap-4 p-6 border-t border-gray-700 rounded-b">
      <button type="button" class="order-2 sm:order-1 px-6 py-3 border border-gray-600 text-gray-300 rounded-md font-medium hover:bg-gray-800 transition-colors" onclick="hideJumlahGolModal()">Batal</button>
      <button type="submit" id="submitJumlahGol" form="jumlahGolForm" class="order-1 sm:order-2 flex-1 bg-blue-600 text-white px-6 py-3 rounded-md font-medium hover:bg-blue-700 transition-colors shadow-md">Simpan Gol</button>
    </div>
  </div>
</div>

<script>
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showJumlahGolModal(editData = null) {
  const modal = document.getElementById('jumlahGolModal');
  const modalContent = document.getElementById('jumlahGolModalContent');
  const form = document.getElementById('jumlahGolForm');
  const titleEl = document.getElementById('modalTitle');
  const submitBtn = document.getElementById('submitJumlahGol');

  form.reset();
  form.removeAttribute('data-edit-id');

  if (editData) {
    titleEl.textContent = 'Edit Data Gol';
    submitBtn.textContent = 'Update Gol';
    form.setAttribute('data-edit-id', editData.id);
    document.getElementById('jumlahGol').value = editData.jumlahGol;
  } else {
    titleEl.textContent = 'Tambah Data Gol Baru';
    submitBtn.textContent = 'Simpan Gol';
  }

  modal.classList.remove('hidden');
  setTimeout(() => {
    modalContent.classList.remove('opacity-0', 'scale-95');
    modalContent.classList.add('opacity-100', 'scale-100');
  }, 50);
}

function hideJumlahGolModal() {
  const modal = document.getElementById('jumlahGolModal');
  const modalContent = document.getElementById('jumlahGolModalContent');
  const form = document.getElementById('jumlahGolForm');

  modalContent.classList.remove('opacity-100', 'scale-100');
  modalContent.classList.add('opacity-0', 'scale-95');

  setTimeout(() => {
    modal.classList.add('hidden');
    form.reset();
    form.removeAttribute('data-edit-id');
  }, 150);
}

async function submitJumlahGol(event) {
  event.preventDefault();
  const form = document.querySelector('#jumlahGolForm');
  const formData = new FormData(form);
  const editId = form.getAttribute('data-edit-id');

  let url;
  if (editId) {
    url = `/stats/api/gol/update/${editId}/`; 
  } else {
    url = "{% url 'stats:add_gol_ajax' %}"; 
  }

  const response = await fetch(url, {
    method: "POST",
    headers: { "X-CSRFToken": getCookie('csrftoken') },
    body: formData,
  });

  if (response.ok) {
    hideJumlahGolModal();
    console.log('Gol berhasil disimpan.');
    if (typeof loadJumlahGolData === 'function') {
        loadJumlahGolData(); 
    }
  } else {
    const errorData = await response.json();
    console.error('Gagal menyimpan gol:', errorData);
  }
}

document.querySelector('#jumlahGolForm').addEventListener('submit', submitJumlahGol);
</script>